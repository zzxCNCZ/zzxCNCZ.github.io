---
title: 个人服务器同步备份之路
date: 2020-12-30 10:03:11
tags:
- Linux
categories:
- System
---

搭建个人服务器的初衷是为了实现NAS的同时，还能部署自己的私有代码仓库，以及部署一些个人的测试环境等等。所以一开始选择机器方面就排除了市面上成熟的NAS产品，而选择了组装一台pc安装linux系统，然后使用各种docker镜像来完成NAS功能的同时，还能满足我的其他需求。

最终选择的机器配置大概是:

- 华硕H110T(该主板有两个千兆网口，以后淘汰了还可以刷软路由，这也是当时选这款主办的重要原因之一)
- cpu:G4560T (其实H110T是可以通过刷bios上8代cpu的，但我不需要很高的性能，因为要7*24小时待机，所以功耗是关键，G4560T tdp为35w，核显为HD630, 4k播放性能也尚可)
- 内存：8g*2
- 硬盘：系统盘：先锋 256g，m.2 2242。仓库盘 1T机械。

<!--more-->
其实从一开始我是直接将系统装在1T的机械硬盘里，但在稳定使用一年后就产生了焦虑，存的东西越来越多，害怕硬盘随时会挂掉。所以后面就入了一块m.2固态，将系统迁移到了固态中，而数据则放在了机械硬盘里，先减少因为系统长时间运行对机械硬盘的频繁读写，毕竟仓储盘是最重要的，系统是什么无所谓，后续迁移也会方便的多。之前尝试过系统直接迁移到新硬盘，但是实际操作过程中会遇到很多问题，在liveCD 下直接两硬盘用dd方式迁移，虽然dd可以拷贝分区表和原始数据，但是拷贝完后还需要修改硬盘id,安装grub修复引导等操作，而且我尝试过两次都没有完美迁移成功，还有就是大量数据时，dd方式不能中断(这个不能完全算是缺点吧，但是可以中断续传的rsync是它的优势之一)。

使用rsync最符合我现在的这种存储模式，系统运行在固态硬盘中，数据盘在机械硬盘中。所以备份或者同步只需要备份机械硬盘中的数据。备份可以选择定期冷备，或者迁移到更大的硬盘中。

定期冷备只需要制作仓储盘镜像，所以直接使用 --delete参数即可。

```shell
rsync -av --delete /media/ /mybackup/
```

注：`mybackup` 为备份盘

可以每隔一个月就备份一次即可，也可以通过定时脚本，定期同步。

这个同步方案最完美状态应该是两块冷备盘，因为如果正在运行的仓储盘产生坏道，而正好又进行了同步，这样会导致备份盘数据也丢失，因此双保险会更加安全。
